# netj's TMUX configuration
# Author: Jaeho Shin <netj@sparcs.org>
# Created: 2010-12-26
# Re-Created: 2026-02-01  # w/ tmux-plugins/tpm

###############################################################################
# Essential config
###############################################################################
# C-t as prefix not C-b b/c it's TMUX not BMUX; moreover, C-b/C-f is essential for EMACS-mode readline in BASH/etc.
set -g prefix C-t; unbind C-b
set -g default-command '$SHELL -l'  # ensure starting a login shell

set -g base-index 1
set -g pane-base-index 1
set -g display-time 2500
setw -g clock-mode-style 24
setw -g wrap-search off
setw -g mouse on
setw -g monitor-activity on
set -g set-titles on

set -g set-titles-string "#T - #I:#W#F#S^#h"
set -g status-left "#T"
set -g status-left-length 48
set -g status-right "#[fg=white,bright]#S#[default]^#[fg=white]#h#[default]"
set -g status-right-length 16
set -g  status-style bg=black
set -ga status-style fg=brightblack
set -g  status-left-style fg=green,bright
setw -g window-status-style fg=brightblack
setw -g window-status-current-style fg=green,bright
setw -g window-status-activity-style fg=yellow,bright
setw -g window-status-bell-style fg=red,bright
setw -g window-status-bell-style fg=red,bright,blink
setw -g window-status-format " #I:#{b:pane_current_path}#F "
setw -g window-status-current-format " #I:#{b:pane_current_path}#F "

set -g pane-border-status top
set -g pane-border-format " #P: #{pane_current_command} | #T "

###############################################################################
# TPM Plugins
###############################################################################
set -g @plugin 'tmux-plugins/tmux-sensible'      # hx limit, mouse, C-n/C-p over awkward n/p

# vim-tmux-navigator with C-M-h/j/k/l (preserving custom bindings)
set -g @plugin 'tmux-plugins/tmux-pain-control'  # move around panes with j and k, a bit like vim; resize panes like vim
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @vim_navigator_mapping_left "C-M-h"
set -g @vim_navigator_mapping_down "C-M-j"
set -g @vim_navigator_mapping_up "C-M-k"
set -g @vim_navigator_mapping_right "C-M-l"
set -g @vim_navigator_mapping_prev ""
set -g @vim_navigator_prefix_mapping_clear_screen ""

set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# resurrect
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'

# continuum
#set -g @plugin 'tmux-plugins/tmux-continuum'
#set -g @continuum-restore 'on'

# Catppuccin theme works slightly better than dracula
set -g @plugin 'catppuccin/tmux'
# set -g @catppuccin_flavor "macchiato"
set -g @catppuccin_flavor "mocha"
# set -g @catppuccin_flavor "latte"
# set -g @catppuccin_flavor "frappe"
set -g @catppuccin_status_background "none"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_pane_status_enabled "yes"
set -g @catppuccin_pane_border_status "yes"

## Initialize TPM (keep this before local config sourcing)
# TODO move from .dotfiles/install
## bootstrap tpm
#if "test ! -d ~/.tmux/plugins/tpm" \
#   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"
# XXX using my fork netj/tpm for now; TODO switch back to tmux-plugins/tpm once merging outstanding improvements
set -g @plugin 'netj/tpm'
if-shell '[ -x ~/.tmux/plugins/netj/tpm/tpm ]' \
    "run '~/.tmux/plugins/netj/tpm/tpm'" \
    "source ~/.tmux-basic.conf"

###############################################################################
# Essential config, continued; also compensating plugin
###############################################################################

# set -g @plugin 'netj/claritmux'  # TODO pull this section out into a tpm plugin
### much clearer status bar with window (bell/activity/current/last) and also pane border
# based on @89iuv's great config from https://github.com/catppuccin/tmux/discussions/317#discussioncomment-11064512
# cf. https://github.com/tmux/tmux/wiki/Formats
# cf. https://www.nerdfonts.com/cheat-sheet

set -ogqF @claritmux_color_bg           '#{@thm_bg}'
set -ogqF @claritmux_color_fg           '#{@thm_overlay_2}'
set -ogqF @claritmux_color_separator    '#{@thm_overlay_0}'
set -ogqF @claritmux_color_inactive     '#{@thm_overlay_0}'
set -ogqF @claritmux_color_active       '#{@thm_green}'
set -ogqF @claritmux_color_bell         '#{@thm_red}'
set -ogqF @claritmux_color_prefix       '#{@thm_sky}'

set -ogqF @claritmux_color_session      '#{@thm_surface_2}'
set -ogqF @claritmux_color_path         '#{@thm_blue}'
set -ogqF @claritmux_color_date         '#{@thm_yellow}'
set -ogqF @claritmux_color_day          '#{@thm_peach}'
set -ogqF @claritmux_color_time         '#{@thm_red}'
set -ogqF @claritmux_color_timezone     '#{@thm_surface_1}'
set -ogqF @claritmux_color_host         '#{@thm_surface_2}'

set -gqF @claritmux_style_status                'bg=#{@claritmux_color_bg}'
set -gqF @claritmux_style_status_separator      'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_separator},none'
set -gqF @claritmux_style_status_while_prefix   'bg=#{@claritmux_color_prefix},fg=#{@claritmux_color_bg},bold'
set -gqF @claritmux_style_status_session        'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_session}'
set -gqF @claritmux_style_status_path           'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_path}'
set -gqF @claritmux_style_status_date           'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_date}'
set -gqF @claritmux_style_status_day            'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_day}'
set -gqF @claritmux_style_status_time           'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_time}'
set -gqF @claritmux_style_status_timezone       'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_timezone}'
set -gqF @claritmux_style_status_host           'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_host}'
set -gqF @claritmux_style_window_status         'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_fg}'
set -gqF @claritmux_style_pane_active           'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_active},bold'
set -gqF @claritmux_style_pane_active_border    'bg=#{@claritmux_color_active},fg=#{@claritmux_color_active}'
set -gqF @claritmux_style_pane_inactive         'bg=#{@claritmux_color_inactive},fg=#{@claritmux_color_bg}'
set -gqF @claritmux_style_pane_inactive_border  'bg=#{@claritmux_color_bg},fg=#{@claritmux_color_inactive}'

set -gq  @claritmux_format_window_named         ' #{=/24/...:#{window_name}}'
set -gq  @claritmux_format_window_unnamed       ' #{=/-24/...:#{b:pane_current_path}}'

set -ogq status-position bottom
set -ogq status-justify left  # or absolute-centre, right

## status left look and feel
set -ogq status-left-length 100
set -gF status-style "#{@claritmux_style_status}"
set -g status-left ""
set -ga status-left "#[#{@claritmux_style_status_session}]"
# show prefix status
set -ga status-left "#{?client_prefix,#{#[#{@claritmux_style_status_while_prefix}]},}"
# show session
set -ga status-left "  #{=/32/...:#{session_name}} "
# last separator
set -ga status-left "#[#{@claritmux_style_status_separator}]│"

## status right look and feel
set -g status-right-length 100
set -g status-right ""
# first separator
set -ga status-right "#[#{@claritmux_style_status_separator}]│"
# show workdir
set -ga status-right "#[#{@claritmux_style_status_path}]  #{=/-32/...:#{s|$HOME|~|:#{pane_current_path}}} "
set -ga status-right "#[#{@claritmux_style_status_separator}]│"
# show time
set -ga status-right " "
set -ga status-right "#[#{@claritmux_style_status_date}]󰭦 %Y-%m-%d"
set -ga status-right "#[#{@claritmux_style_status_day}] %a "
set -ga status-right "#[#{@claritmux_style_status_time}]󰅐 %H:%M:%S"
set -ga status-right "#[#{@claritmux_style_status_timezone}] %Z"
set -g  status-interval 1
set -ga status-right " "
set -ga status-right "#[#{@claritmux_style_status_separator}]│"
# show host
set -ga status-right "#[#{@claritmux_style_status_host}] 󰒍 #h "

# window look and feel
set -wg automatic-rename on
set -g automatic-rename-format ""
set -gF window-status-format         " ##I:##{?##{!=:##{window_name},},#{@claritmux_format_window_named},#{@claritmux_format_window_unnamed}} "
set -gF window-status-current-format " ##I:##{?##{!=:##{window_name},},#{@claritmux_format_window_named},#{@claritmux_format_window_unnamed}} "
set -gF window-status-separator      "#[#{@claritmux_style_status_separator}]│#[default]"
set -gF window-status-style          "#{@claritmux_style_window_status}"
set -gF window-status-current-style  "bg=#{@claritmux_color_active},fg=#{@claritmux_color_bg},bold"
set -gF window-status-last-style     "bg=#{@claritmux_color_bg},fg=#{@claritmux_color_active},bold"
set -gF window-status-activity-style "blink"
set -gF window-status-bell-style     "bg=#{@claritmux_color_bell},blink,fg=#{@claritmux_color_bg},blink"

# pane border look and feel
setw -g pane-border-status top
setw -g  pane-border-format ""
# TODO show zoom status and title when zoomed or only one pane
setw -ga pane-border-format "#{?pane_active,#{#[#{@claritmux_style_pane_active}]},#{#[#{@claritmux_style_pane_inactive}]}}"
setw -ga pane-border-format " "
setw -ga pane-border-format "#{?window_zoomed_flag,  ,}"
setw -ga pane-border-format " #P: #{pane_current_command} "
setw -ga pane-border-format "│"
setw -ga pane-border-format " #T "
setw -ga pane-border-format " "
setw -ga pane-border-format "#[default]"
setw -gF pane-active-border-style "#{@claritmux_style_pane_active_border}"
setw -gF pane-border-style        "#{@claritmux_style_pane_inactive_border}"
setw -g pane-border-lines single


## easier session/window actions
unbind ^D; bind ^D detach           # easier detach w/ Ctrl
unbind ^C; bind ^C new-window -c "#{pane_current_path}"  # easier new window
unbind  C; bind  C new-session      # easier new session
bind Tab attach-session -d          # easier to detach all other clients to make this client the only one
bind ` confirm-before kill-session  # easier kill-session

## settings for TMUX in TMUX windows/panes
# C-t t to send prefix is a more sensible escaping scheme than TMUX or tmux-plugins/tmux-sensible's default
# b/c when using TMUX in TMUX (double-decker or more), you really don't want to press C-t 2^k times but just press C-t once followed by the t key only k times for sending the prefix key to the k-th inner/nested TMUX sessions
unbind C-t; bind C-t last-window
unbind   t; bind   t send-prefix
# swap outer TMUX prefix to a different one to let the usual prefix directly reach the inner TMUX
bind T \
    if-shell "[ \"`tmux show-options prefix`\" = 'prefix C-t' ]" \
        "set prefix C-s; unbind -n M-Up;           unbind -n M-PageUp" \
        "set prefix C-t;   bind -n M-Up copy-mode;   bind -n M-PageUp copy-mode" \
        #

## easier window selection with an alert via lifting Ctrl (NOTE prefix C-n/C-p in tmux-sensible selects all windows)
bind n next-window -a
bind p previous-window -a

## easier pane selection/rotation (default is not symmetric and a bit awkward)
bind C-o select-pane -t :.+
bind   o select-pane -t :.-
bind   O rotate-window
bind M-o rotate-window -D

# prefix + number: select pane directly (1-indexed)
# NOTE prefix ' then number let's select-window by number easily
bind 1 select-pane -t .1
bind 2 select-pane -t .2
bind 3 select-pane -t .3
bind 4 select-pane -t .4
bind 5 select-pane -t .5
bind 6 select-pane -t .6
bind 7 select-pane -t .7
bind 8 select-pane -t .8
bind 9 select-pane -t .9
bind 0 select-pane -t .10

## Ctrl+Opt/Alt: quicker access to frequently used prefix combos
bind -n C-M-z  resize-pane -Z  # quick toggle zoom pane          (normally prefix z)
bind -n C-M-\\ select-pane -l  # quick switching btwn last panes (normally prefix ;) cf. vim_navigator_mapping_prev
# quicker vim-like split
bind -n C-M-v split-window -h -b -c "#{pane_current_path}"
bind -n C-M-n split-window -v -b -c "#{pane_current_path}"
bind -n C-M-s split-window -v -b -c "#{pane_current_path}"

# quick commands in new pane with Ctrl+Opt
bind -n C-M-f split-window -h -b -c "#{pane_current_path}" vim +Files
bind -n C-M-t split-window -h -b -c "#{pane_current_path}" vim +Tags
bind -n C-M-g split-window -h -b -c "#{pane_current_path}" lazygit
bind -n C-M-c split-window -v -b -c "#{pane_current_path}" claude


###############################################################################
# Local config
###############################################################################
if-shell "[ -e ~/.tmux_local ]" "source-file ~/.tmux_local"

# vim:ft=tmux
